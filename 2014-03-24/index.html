<!DOCTYPE html>
<html lang="en">
<head>
    <!-- https://developers.google.com/chrome/mobile/docs/installtohomescreen -->
    <meta charset="utf-8" />
    <title>jspspemu</title>
    <meta name="viewport" content="width=480, initial-scale=0.75, maximum-scale=0.75, minimum-scale=0.75, user-scalable=no">

    <link rel="apple-touch-icon" href="./icon.png" />
    <link rel="apple-touch-icon-precomposed" href="./icon.png" />
    <link rel="shortcut icon" href="./icon.png" />
    <link rel="shortcut icon" sizes="196x196" href="./icon.png" />
    <link rel="shortcut icon" sizes="128x128" href="./icon.png" />

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <script src="lib/jquery-2.1.0.js"></script>
    <script src="lib/gl-matrix.js"></script>
    <script src="lib/underscore.js"></script>
    <script src="lib/zlib_and_gzip.min.js"></script>
    <script src="lib/zlib/rawinflate.min.js"></script>
    <script src="polyfills/promise-0.1.1.js"></script>
    <script src="src/util/sprintf.js"></script>
    <script src="src/util/utils.js"></script>

    <script src="src/core/memory.js"></script>

    <script src="src/core/cpu/state.js"></script>
    
    <script src="src/ast.js"></script>

    <script src="src/core/syscallmanager.js"></script>
    <script src="src/core/cpu/instructions.js"></script>
    <script src="src/core/cpu/cpu_ast.js"></script>
    <script src="src/core/cpu/assembler.js"></script>

    <script src="src/cpu.js"></script>
    <script src="src/core/audio.js"></script>
    <script src="src/core/rtc.js"></script>
    <script src="src/core/display.js"></script>
    <script src="src/core/controller.js"></script>
    <script src="src/core/gpu.js"></script>
    <script src="src/hle/filemanager.js"></script>
    <script src="src/hle/memorymanager.js"></script>
    <script src="src/hle/threadmanager.js"></script>
    <script src="src/hle/elf.js"></script>

    <script src="src/format/format.js"></script>
    <script src="src/format/cso.js"></script>
    <script src="src/format/iso.js"></script>
    <script src="src/format/pbp.js"></script>
    <script src="src/format/psf.js"></script>

    <script src="src/hle/vfs/vfs.js"></script>

    <script src="src/hle/_utils.js"></script>
    <script src="src/hle/modules/IoFileMgrForUser.js"></script>
    <script src="src/hle/modules/LoadExecForUser.js"></script>
    <script src="src/hle/modules/LoadCoreForKernel.js"></script>
    <script src="src/hle/modules/ModuleMgrForUser.js"></script>
    <script src="src/hle/modules/sceAudio.js"></script>
    <script src="src/hle/modules/sceCtrl.js"></script>
    <script src="src/hle/modules/sceUtility.js"></script>
    <script src="src/hle/modules/sceNet.js"></script>
    <script src="src/hle/modules/sceNetInet.js"></script>
    <script src="src/hle/modules/sceNetApctl.js"></script>
    <script src="src/hle/modules/sceNetResolver.js"></script>
    <script src="src/hle/modules/sceDmac.js"></script>
    <script src="src/hle/modules/sceDisplay.js"></script>
    <script src="src/hle/modules/sceGe_user.js"></script>
    <script src="src/hle/modules/scePower.js"></script>
    <script src="src/hle/modules/sceRtc.js"></script>
    <script src="src/hle/modules/StdioForUser.js"></script>
    <script src="src/hle/modules/SysMemUserForUser.js"></script>
    <script src="src/hle/modules/ThreadManForUser.js"></script>
    <script src="src/hle/modules/UtilsForUser.js"></script>
    <script src="src/hle/modules/UtilsForKernel.js"></script>
    <script src="src/hle/modules/sceHprm.js"></script>
    <script src="src/hle/modules/KDebugForKernel.js"></script>
    <script src="src/hle/modules/sceAtrac3plus.js"></script>
    <script src="src/hle/modules/sceUmdUser.js"></script>
    <script src="src/hle/modules/Kernel_Library.js"></script>
    <script src="src/hle/modules/sceSasCore.js"></script>
    <script src="src/hle/modules/sceMpeg.js"></script>
    <script src="src/hle/modules/sceSuspendForUser.js"></script>
    <script src="src/hle/modules/sceNetAdhoc.js"></script>
    <script src="src/hle/modules/sceNetAdhocctl.js"></script>
    <script src="src/hle/modules/sceNetAdhocMatching.js"></script>
    <script src="src/hle/modules/sceWlanDrv.js"></script>
    <script src="src/hle/modules/InterruptManager.js"></script>
    <script src="src/hle/modules/sceImpose.js"></script>
    
    <script src="src/hle/modulemanager.js"></script>

    <style type="text/css">
        @font-face {
            font-family: 'Buttons';
            src: url('buttons.ttf');
        }

        body {
            background: #222;
            margin: 0;
            padding: 0;
            /*width: 480px;*/
            overflow: hidden;
            cursor: default;
        }
        #buttons {
            color: white;
            font: 64px Buttons;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }
        #buttons span {
            padding: 4px;
            display: inline-block;
            opacity: 0.7;
        }
        #buttons span.pressed {
            opacity: 1.0;
        }
        #output {
            color: white;
            white-space: pre;
            font: 10px 'Lucida Console';
            height: 272px;
            max-height: 272px;
            overflow-y: scroll;
        }
    </style>
</head>
<body>
    <!-- <canvas id="canvas" width="480" height="272" style="background:black;width:960px;height:544px;"></canvas> -->
    <div>
        <canvas id="canvas" width="480" height="272" style="background:black;width:480px;height:272px;border:0;display:inline-block;"></canvas>
        <canvas id="webgl_canvas" width="480" height="272" style="background: black; width: 480px; height: 272px; border: 0; display: inline-block;"></canvas>
    </div>
    <div id="thread_list" style="color:white;"></div>

    <select id="files"></select>
    <input type="file" id="load_file" name="load_file" />

    <script>
        var demos = [
            "samples/counter.elf",
            "samples/fputest.elf",
            "samples/minifire.elf",
            "samples/ortho.elf",
            "samples/polyphonic.elf",
            "samples/controller.elf",
            "samples/cube.elf",
            "samples/lines.pbp",
            "samples/HelloWorldPSP.elf",
            "samples/rtctest.elf",
            "samples/rtctest.pbp",
            "samples/compilerPerf.elf",
            "samples/threadstatus.elf",
            "samples/mytest.elf",
        ];
        $('#files').html('');
        var selectedItem = document.location.hash.substr(1);
        $('#files').append('<option value="">-- SELECT DEMO --</option>');
        demos.forEach(function(fileName) {
            var item = $('<option value="' + fileName + '">' + fileName + '</option>');
            if (selectedItem == fileName) item.attr('selected', 'selected')
            $('#files').append(item);
        });
        $('#files').change(function () {
            console.clear();
            document.location.hash = $('#files').val();
            //emulator.downloadAndExecuteAsync(document.location.hash.substr(1));
            //downloadAnd
            //document.location = 'index.html?' + $('#files').val();
        });
        $('#load_file').change(function (e) {
            if (e.target.files && e.target.files.length > 0) {
                console.clear();
                emulator.executeFileAsync(e.target.files[0]);
            }
        });
        $(window).on('hashchange', function() {
            console.clear();
            emulator.downloadAndExecuteAsync(document.location.hash.substr(1));
        });
        //<a href="index.html?' + fileName + '" style="color:white;">
    </script>

    <div id="fullScreen">
        <a href="javascript:document.body.webkitRequestFullScreen();$('#fullScreen').hide();" style="font:24px Arial;color:white;">Fullscreen</a>
    </div>

    <div id="buttons">
        <span id="button_left">2</span>
        <span id="button_up">3</span>
        <span id="button_right">1</span>
        <span id="button_down">4</span>
        <span id="button_up_right">5</span>
        <span id="button_down_right">6</span>
        <span id="button_up_left">7</span>
        <span id="button_down_left">8</span>
        

        <span id="button_cross">X</span>
        <span id="button_circle">C</span>
        <span id="button_triangle">T</span>
        <span id="button_square">S</span>

        <span id="button_l">l</span>
        <span id="button_r">r</span>

        <span id="button_start">A</span>
        <span id="button_select">B</span>
    </div>

    <script src="src/app.js"></script>

    <script>
        controllerRegister();
    </script>

    <div id="output"></div>
</body>
</html>
